{% extends 'base.html.twig' %}

{% block title %}{{'project.title'|trans}}{% endblock %}

{% block body %}
<div class="page-heading">
    <h3>{{ 'project.show.title'|trans({ '%address%': project.address.getInlineAddress() }) }}</h3>
</div>
{{ include('_partials/_flash_message.html.twig') }}
<div class="page-content">
    <section class="row">
        <div class="col-12 col-lg-7">
            <div class="card">
                <div class="card-content">
                    <div class="card-body">
                        {{ form_start(projectForm, {'attr': {'class':'form-group d-flex justify-content-between'}}) }}
                            {{ form_errors(projectForm) }}
                            <div class="me-3">
                                {{ form_label(projectForm.state, null, {'label_attr': {'class': 'col-form-label'}}) }}
                            </div>
                            <div class="me-3">
                                {{ form_widget(projectForm.state, {'attr': {'class':'form-select'}}) }}
                            </div>
                            <div class="me-3">
                                {{ form_label(projectForm.goodsType, null, {'label_attr': {'class': 'col-form-label'}}) }}
                            </div>
                            <div class="me-3">
                                {{ form_widget(projectForm.goodsType, {'attr': {'class':'form-select'}}) }}
                            </div>
                            <button class="btn btn-primary" type="submit">{{'project.form_field.submit'|trans}}</button>
                        {{ form_end(projectForm) }}
                        <div class="d-flex mb-2 flex-column">
                            <h6>{{ 'project.show.contact.title'|trans }}</h6>
                            <div class="mb-2">{{ 'contact.type.seller'|trans|capitalize }} :
                                {% if project.seller is null %}
                                    {% set modalId = 'add-contact-seller' %}
                                    {% set modalAction = 'add' %}
                                    {% set modalTitle = 'project.show.contact.modal_title.add.seller'|trans %}
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#{{ modalId }}"><i class="bi bi-person-plus-fill"></i></a>
                                {% else %}
                                    {% set modalId = 'show-contact-seller' %}
                                    {% set modalAction = 'show' %}
                                    {% set modalTitle = 'project.show.contact.modal_title.edit.seller'|trans({'%lastname%':project.seller.lastname, '%firstname%':project.seller.firstname}) %}
                                    {{ project.seller.firstname }} {{ project.seller.lastname }}
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#{{ modalId }}"><i class="bi bi-search"></i></a>
                                    <a href="{{ path('project_remove_contact', {'id':project.id, 'contact':project.seller.id}) }}" onclick="return confirm('Vous allez supprimer le contact du projet. Voulez-vous continuer ?');">
                                        <i class="bi bi-person-dash-fill"></i>
                                    </a>
                                {% endif %}
                                {% include 'project/modal/contact_edit.html.twig' with {
                                    'modalId': modalId,
                                    'contactForm': sellerContactForm,
                                    'modalTitle': modalTitle,
                                    'searchForm': searchForms['seller'],
                                    'modalAction': modalAction,
                                    'contactType': constant('App\\Entity\\Contact\\Seller::TYPE')
                                } only %}
                            </div>
                            <div class="mb-2">
                                {{ 'contact.type.estate_agent'|trans|capitalize }} :
                                {% if project.estateAgent is null %}
                                    {% set modalId = 'add-contact-estate-agent' %}
                                    {% set modalAction = 'add' %}
                                    {% set modalTitle = 'project.show.contact.modal_title.add.estate_agent'|trans %}
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#{{ modalId }}"><i class="bi bi-person-plus-fill"></i></a>
                                {% else %}
                                    {% set modalId = 'edit-contact-estate-agent' %}
                                    {% set modalAction = 'show' %}
                                    {% set modalTitle = 'project.show.contact.modal_title.edit.estate_agent'|trans({'%lastname%':project.estateAgent.lastname, '%firstname%':project.estateAgent.firstname}) %}
                                    {{ project.estateAgent.firstname }} {{ project.estateAgent.lastname }}
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#{{ modalId }}"><i class="bi bi-search"></i></a>
                                    <a href="{{ path('project_remove_contact', {'id':project.id, 'contact':project.estateAgent.id}) }}" onclick="return confirm('Vous allez supprimer le contact du projet. Voulez-vous continuer ?');">
                                        <i class="bi bi-person-dash-fill"></i>
                                    </a>
                                {% endif %}
                                {% include 'project/modal/contact_edit.html.twig' with {
                                    'modalId': modalId,
                                    'contactForm':estateAgentContactForm,
                                    'modalTitle': modalTitle,
                                    'searchForm': searchForms['estate-agent'],
                                    'modalAction': modalAction,
                                    'contactType': constant('App\\Entity\\Contact\\EstateAgent::TYPE')
                                } only %}
                            </div>
                            <div class="mb-2">
                                {{ 'contact.type.notary'|trans|capitalize }} :
                                {% if project.notary is null %}
                                    {% set modalId = 'add-contact-notary' %}
                                    {% set modalAction = 'add' %}
                                    {% set modalTitle = 'project.show.contact.modal_title.add.notary'|trans %}
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#{{ modalId }}"><i class="bi bi-person-plus-fill"></i></a>
                                {% else %}
                                    {% set modalId = 'show-contact-notary' %}
                                    {% set modalAction = 'show' %}
                                    {% set modalTitle = 'project.show.contact.modal_title.edit.notary'|trans({'%lastname%':project.notary.lastname, '%firstname%':project.notary.firstname}) %}
                                    {{ project.notary.firstname }} {{ project.notary.lastname }}
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#{{ modalId }}"><i class="bi bi-search"></i></a>
                                    <a href="{{ path('project_remove_contact', {'id':project.id, 'contact':project.notary.id}) }}" onclick="return confirm('Vous allez supprimer le contact du projet. Voulez-vous continuer ?');">
                                        <i class="bi bi-person-dash-fill"></i>
                                    </a>
                                {% endif %}
                                {% include 'project/modal/contact_edit.html.twig' with {
                                    'modalId': modalId,
                                    'contactForm':notaryContactForm,
                                    'modalTitle': modalTitle,
                                    'searchForm': searchForms['notary'],
                                    'modalAction': modalAction,
                                    'contactType': constant('App\\Entity\\Contact\\Notary::TYPE')
                                } only %}
                            </div>
                        </div>
                        {# Address and urban documents part#}
                        <div class="row">
                            <div class="col-12 col-lg-5">
                                <h6>{{ 'project.card.more_information_address'|trans }}</h6>
                                <p>
                                    {{ project.address.addressLine1 }}
                                    {% if project.address.addressLine2 is not null %}
                                        <br>
                                        {{ project.address.addressLine1 }}
                                    {% endif %}
                                    <br>
                                    {{ project.address.postalCode }} {{ project.address.city }}
                                </p>
                                <h6>{{ 'project.card.gps_coordinates.title'|trans }}</h6>
                                <p>
                                    {{ 'project.card.gps_coordinates.latitude'|trans }} : {{ project.address.latitude }}
                                    <br>
                                    {{ 'project.card.gps_coordinates.longitude'|trans }} : {{ project.address.longitude }}
                                </p>
                            </div>
                            <div class="col-12 col-lg-7">
                                <h6>{{ 'project.card.urban_document.document_available'|trans }}</h6>
                                {% if project.urbanDocuments is empty %}
                                    <p>{{ 'project.card.urban_document.no_documents_exist'|trans }}</p>
                                {% else %}
                                    <ul>
                                        {% for urbanDocument in project.urbanDocuments %}
                                            <li>{{ urbanDocument.name }} -
                                                <a href="{{ urbanDocument.archiveLink }}">
                                                    <small>{{ 'project.card.urban_document.download_archive'|trans }}</small>
                                                </a>
                                            </li>
                                            <ul>
                                                {% for file in urbanDocument.urbanFiles %}
                                                    <li><a target="_blank" href="{{ file.link }}">{{ file.name }}</a></li>
                                                {% endfor %}
                                            </ul>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                        {# Maps part#}
                        <div class="row">
                            <div class="col-12 col-lg-6">
                                <h6>{{ 'project.card.map.aerial_view_with_casdastral_cut'|trans }}</h6>
                                <div
                                        id="aerial-map"
                                        data-longitude="{{ project.address.longitude }}"
                                        data-latitude="{{ project.address.latitude }}"
                                >
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <h6>{{ 'project.card.map.dynamic_street_view'|trans }}</h6>
                                <div
                                        id="street-view-map-pano"
                                        data-longitude="{{ project.address.longitude }}"
                                        data-latitude="{{ project.address.latitude }}"
                                >
                                    <p>{{ 'project.card.map.no_street_view_exist'|trans }}</p>
                                </div>
                            </div>
{#                                <div class="mt-3 col-12">#}
{#                                    <p>{{ 'dashboard.project.preview.square_metre_price'|trans({'%price%': 500}) }}</p>#}
{#                                </div>#}
                        </div>
                        {# Sales in address area #}
                        <div class="row">
                            <div class="col-12">
                                <h6>{{ 'project.card.sales_in_delimited_area.title'|trans({'%km%':5}) }}</h6>
                                {% if proximitySalesPagination is not null %}
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered">
                                            <thead>
                                            <tr>
                                                <th>{{ 'project.card.sales_in_delimited_area.table.header.address'|trans }}</th>
                                                <th>{{ 'project.card.sales_in_delimited_area.table.header.price'|trans }}</th>
                                                <th>{{ 'project.card.sales_in_delimited_area.table.header.date'|trans }}</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for proximitySale in proximitySalesPagination %}
                                                <tr>
                                                    <td>{{ proximitySale.address }}</td>
                                                    <td>{{ proximitySale.salePrice }} €</td>
                                                    <td>{{ proximitySale.saleDate|date('d/m/Y') }}</td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    <nav id="proximity-sales-pagination">
                                        {{ knp_pagination_render(proximitySalesPagination) }}
                                    </nav>
                                {% else %}
                                    <p>{{ 'project.card.no_proximity_sale'|trans }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-5">
            <div class="card">
                <div class="card-content">
                    <div class="card-body">
                        Coming soon
{#                        <div class="row">#}
{#                            <div class="col-12">#}
{#                                Formulaire calcul de rentablité - coming soon#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="row">#}
{#                            <div class="d-flex">#}
{#                                <h6 class="cart-title me-auto">Image uploader</h6>#}
{#                                <button class="btn btn-sm btn-outline-primary">Upload coming soon</button>#}
{#                            </div>#}
{#                        </div>#}
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('streetViewMap') }}
    {{ encore_entry_script_tags('aerialViewMap') }}
    {{ encore_entry_script_tags('contactSearchBar') }}
{% endblock %}
