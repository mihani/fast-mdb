{% extends 'base.html.twig' %}
{% block body %}
<div class="page-heading">
    <h3>{{ 'dashboard.title'|trans }}</h3>
</div>
{{ include('_partials/_flash_message.html.twig') }}
<div class="page-content">
    <section class="row">
        <div class="col-12 col-lg-6">
            <div class="card">
                <div class="card-content">
                    <div class="card-body">
                        <h4 class="cart-title">{{ 'dashboard.project.list.title'|trans }}</h4>
                        <p class="card-text">Coming soon</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="card">
                <div class="card-content">
                    <div class="card-body">
                        <h4 class="cart-title">{{ 'dashboard.project.preview.title'|trans }}</h4>
                        <div class="row">
                            <div class="col-12">
                                {{ form_start(searchBarForm, {'attr': {'class':'address-search-bar'}}) }}
                                <div class="input-group address-search-bar__input-group">
                                    <span class="input-group-text" id="search-address-button">
                                        <i class="bi bi-search"></i>
                                    </span>
                                    {{ form_widget(searchBarForm.address, {'attr':{'class':'form-control dashboard-new-project-search-bar','aria-describedby':'search-address-button'}}) }}
                                    <button class="btn btn-primary" type="submit" id="search-address-button">{{'dashboard.project.preview.form_field.search.submit'|trans}}</button>
                                </div>
                                <div id="address-search-bar__list-group" class="list-group address-search-bar__list-group">

                                </div>
                                {{ form_end(searchBarForm) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% if addressData is not null %}
                <div class="card">
                    <div class="card-content">
                        <div class="card-body">
                            {# Address and urban documents part#}
                            <div class="row">
                                <div class="col-12 col-md-5">
                                    <h6>{{ 'project.card.more_information_address'|trans }}</h6>
                                    <p>
                                        {{ addressData.address.name }}
                                        <br>
                                        {{ addressData.address.postCode }} {{ addressData.address.city }}
                                    </p>
                                    <h6>{{ 'project.card.insee_code'|trans }}</h6>
                                    <p>{{ addressData.inseeCode }}</p>
                                    <h6>{{ 'project.card.gps_coordinates.title'|trans }}</h6>
                                    <p>
                                        {{ 'project.card.gps_coordinates.latitude'|trans }} : {{ addressData.latitude }}
                                        <br>
                                        {{ 'project.card.gps_coordinates.longitude'|trans }} : {{ addressData.longitude }}
                                    </p>
                                </div>
                                <div class="col-12 col-md-7">
                                    <h6>{{ 'project.card.urban_document.document_available'|trans }}</h6>
                                    {% if urbanDocuments is null %}
                                        <p>{{ 'project.card.urban_document.no_documents_exist'|trans }}</p>
                                    {% else %}
                                        <ul>
                                            {% for urbanDocument in urbanDocuments %}
                                                <li>{{ urbanDocument.name }} -
                                                    <a href="{{ urbanDocument.archiveLink }}">
                                                        <small>{{ 'project.card.urban_document.download_archive'|trans }}</small>
                                                    </a>
                                                </li>
                                                <ul>
                                                    {% for file in urbanDocument.files %}
                                                        <li><a target="_blank" href="{{ file.link }}">{{ file.name }}</a></li>
                                                    {% endfor %}
                                                </ul>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            {# Maps part#}
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <h6>{{ 'project.card.map.aerial_view_with_casdastral_cut'|trans }}</h6>
                                    <div
                                        id="aerial-map"
                                        data-longitude="{{ addressData.longitude }}"
                                        data-latitude="{{ addressData.latitude }}"
                                    >
                                    </div>
                                </div>
                                <div class="col-12 col-md-6">
                                    <h6>{{ 'project.card.map.dynamic_street_view'|trans }}</h6>
                                    <div
                                        id="street-view-map-pano"
                                        data-longitude="{{ addressData.longitude }}"
                                        data-latitude="{{ addressData.latitude }}"
                                    >
                                        <p>{{ 'project.card.map.no_street_view_exist'|trans }}</p>
                                    </div>
                                </div>
{#                                <div class="mt-3 col-12">#}
{#                                    <p>{{ 'dashboard.project.preview.square_metre_price'|trans({'%price%': 500}) }}</p>#}
{#                                </div>#}
                            </div>
                            {# Sales in address area #}
                            <div class="row">
                                <div class="col-12">
                                    <h6>{{ 'project.card.sales_in_delimited_area.title'|trans({'%km%':5}) }}</h6>
                                    {% if proximitySalesPagination is not null %}
                                        <div class="table-responsive">
                                            <table class="table table-striped table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th>{{ 'project.card.sales_in_delimited_area.table.header.address'|trans }}</th>
                                                        <th>{{ 'project.card.sales_in_delimited_area.table.header.price'|trans }}</th>
                                                        <th>{{ 'project.card.sales_in_delimited_area.table.header.date'|trans }}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                {% for proximitySale in proximitySalesPagination %}
                                                    <tr>
                                                        <td>{{ proximitySale.address }}</td>
                                                        <td>{{ proximitySale.salePrice }} â‚¬</td>
                                                        <td>{{ proximitySale.saleDate|date('d/m/Y') }}</td>
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        <nav id="proximity-sales-pagination">
                                            {{ knp_pagination_render(proximitySalesPagination) }}
                                        </nav>
                                    {% else %}
                                        <p>{{ 'project.card.no_proximity_sale'|trans }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="col-12 justify-content-center d-flex">
                                    {{ form_start(projectFromPreviewForm) }}
                                    {{ form_widget(projectFromPreviewForm.urbanDocuments, {'attr': {'class' : 'visually-hidden'}}) }}
                                    {{ form_widget(projectFromPreviewForm.address, {'attr': {'class' : 'visually-hidden'}}) }}
                                    <button class="btn btn-primary" type="submit" id="create-project-button">{{'dashboard.project.preview.form_field.create_project.submit'|trans}}</button>
                                    {{ form_end(projectFromPreviewForm) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </section>
</div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('addressSearchBar') }}
    {{ encore_entry_script_tags('streetViewMap') }}
    {{ encore_entry_script_tags('aerialViewMap') }}
{% endblock %}
